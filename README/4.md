### 购物车功能

- 加入购物车
    * 获取商品信息数据(商品id: goods_id，颜色id: color_id)
    * 判断购物车(cookies)是否存在数据
    * 如果购物车空的，直接写入当前数据
    * 如果购物车存在数据
        * 判断购物车是否存在当前数据
        * 存在，则当前数据自增1
        * 不存在，则将当前数据写入cookies
- 加入成功页面
- 购物车商品列表
- 购物车内增加商品数量
- 购物车内减少商品数量
- 删除购物车数据
- 改变购物车数据状态(选中)
- 改变购物车所有数据状态
- 关于购物车数据的保存
    * 方法1：保存购物车数据在本地
    * 方法2：保存购物车数据在服务器
    * 方法3：先保存购物车数据在本地，用户登录后同步到服务器(项目使用这种，所以暂不需要考虑用户是否登录)
- 封装cookie相关操作
    * 注意设置httpOnly来只让后端修改cookie,保护数据安全
    * 具体参考：app/service/cookies.js
- 购物车工具方法
    * 参考：app/service/cart.js
- 去结算功能
  * 涉及到用户是否登录的判断
  * 属于购物车的一部分功能
- 购物车所有功能
    * 具体参考：app/controller/web/cart.js

### 前台用户注册登录功能

**短信**

- 我们的后端想要使用短信接口服务，一般需要如下步骤：
- 一、找到短信运营商
    * 云片: https://www.yunpian.com/
    * 聚合数据: https://www.juhe.cn/service
    * 阿里大鱼
    * 腾讯云
    * ...
    * 甚至可以搜索"短信接口运营商"
- 二、在运营商网站注册并完成认证
    * 这里我们采用云片提供的服务
- 三、在其后台管理中创建签名
    * 这个签名一般就是我们自己企业的公司名或者相关品牌标识
    * 签名显示在短信内容的最前面，显示这条短信来自哪家公司/产品/网站。因运营商要求，签名需经过审核
- 四、创建模板
    * 一般模板的内容如下：
    * 您的验证码是#code#, 如非本人操作，请忽略本短信
- 五、找到sdk和官方文档实现发送短信
    * 没有提供nodejs的SDK，但是提供nodejs的示例代码, 如下链接，因为是项目外链，不保证一直可以访问：
    * https://www.yunpian.com/official/document/sms/zh_CN/introduction_demos_nodejs
    * 将其代码拿到封装成我们自己的库
    * 示例代码提供：单条短信发送，模板短信发送，语音短信发送等
    * 注意，一般会有使用限制，电信运营商不允许一直发验证码(恶意攻击)，验证类短信1小时内同一手机号发送次数不能超过3次，这个可以和运营商沟通
    * 同时，我们在项目中也应该有相同的限制处理，禁止用户频繁发送短信验证码
    * 还要注意，如果短信出现异常应该记录至日志或数据库中
    * 参考项目代码：app/service/sendmsg.js

**登录**

- 注册登录的验证程序最好在前台用相关validate库进行操作TODO，可以优化
- 在提交数据的时候注意关闭csrf验证，在config中的ignore中配置
- 登录的时候是否需要做一些登录日志的记录TODO, 如: user_log, admin_log 表
- 扫码登录是否需要做TODO，(扫码登录的原理)
- 登录安全性问题考虑：
    * 验证码的安全性问题：注意当登录发生错误时，要重新生成一次验证码(前后端都要同步处理)
    * 前台传递参数时候，关于密码需要进行md5加密传输TODO, 后台继续加密已经加密后的密码，之后与数据库中的密码进行比较验证
    * 使用cookie存储登录信息的时候，一定要注意加密操作，具体见cookie的封装

**注册**

- 注册的一般步骤
    * 填写手机号和图形验证码，一般需要验证手机号是否合法，是否在用户中存在
    * 图形验证码验证成功，则请求服务器接口生成短信验证码并发送短信
    * 用户接收到短信，输入短信验证码，用户点击下一步
    * 通过接口，服务器验证用户输入的验证码和后台发送的验证码是否一致
    * 不一致则提示，一致则进入下一个页面进行设置账户密码操作
    * 之后将用户手机号和密码作为一个新的用户进行生成新的用户
- 需要注意的是前后台的图形验证码要分开，不能使用一个，否则会出问题
- 在数据库中有两张用户表：user_temp, user 
    * user_temp 用于限制短信发送次数
    * user 真正的用户表
    * 注意程序中关于次数的验证逻辑：不仅针对手机号，而且针对ip
- 关于密码的存储问题，需要前台进行加密处理，后台再次加密之后存储
- 注意，注册完毕后就直接登录：因为验证用户信息的在中间件中，只需要查询用户保存cookie即可，之后跳转即实现了自动登录
- 具体参考项目代码：app/web/user.js

### 确定订单功能

- 在下单之前，一般需要选择收货地址，快递，发票，兑换券等操作, 也就是确定订单功能，项目只涉及收货地址的选择，没有其他复杂业务
- 收货地址相关功能
    * 用户与地址是1对多的关系
    * 具体功能有：新增收货地址，获取收货地址列表，获取单个收货地址，编辑单个收货地址，修改默认收货地址，移除收货地址TODO
        * 新增收货地址需要特别注意: 更新用户所有地址的默认地址状态为0，新增当前地址并设置默认地址状态为1，查询用户所有收货地址返回
    * 主要是对address表的增删查改操作，注意默认收货地址的字段
- 具体参考项目代码：app/web/address.js